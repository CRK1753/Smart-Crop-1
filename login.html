<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Login</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
<style>
body{background:#e6f3ea;font-family:system-ui;padding:20px;}
.card{max-width:420px;margin:auto;}
.eye-toggle{
  cursor:pointer;
  display:flex;
  align-items:center;
  padding:0 10px;
  font-size:20px;
  color:#555;
}
</style>
</head>
<body>

<div class="card p-4 shadow">
  <h3 class="text-success text-center mb-3">Sign In</h3>
  <form id="loginForm">

    <!-- Email or Phone -->
    <input type="text" class="form-control mb-3" id="loginUser"
           placeholder="Email or Mobile Number" required>

    <!-- Password with Eye Icon -->
    <div class="input-group mb-3">
      <input type="password" class="form-control" id="loginPassword" placeholder="Password" required>
      <span class="input-group-text eye-toggle" id="togglePassword">
        <i class="bi bi-eye"></i>
      </span>
    </div>

    <!-- Captcha -->
    <div class="mb-3">
      <label class="form-label">Captcha</label>
      <div class="d-flex">
        <input type="text" id="captchaInput" class="form-control me-2" placeholder="Enter Captcha" required>
        <span id="captchaText" class="border p-2 bg-light"></span>
      </div>
    </div>

    <button class="btn btn-success w-100">Login</button>
  </form>
  <p class="text-center mt-3">New user? <a href="signup.html">Sign Up</a></p>
</div>

<script>
const captchaText = document.getElementById('captchaText');
const captchaInput = document.getElementById('captchaInput');
const passwordField = document.getElementById('loginPassword');
const togglePassword = document.getElementById('togglePassword');
const loginForm = document.getElementById('loginForm');

function newCaptcha(){
  const code = Math.random().toString(36).substring(2,7).toUpperCase();
  captchaText.textContent = code;
  return code;
}
let captchaCode = newCaptcha();

// ✅ Toggle password visibility
togglePassword.addEventListener('click', () => {
  const icon = togglePassword.querySelector('i');
  if (passwordField.type === 'password') {
    passwordField.type = 'text';
    icon.classList.remove('bi-eye');
    icon.classList.add('bi-eye-slash');
  } else {
    passwordField.type = 'password';
    icon.classList.remove('bi-eye-slash');
    icon.classList.add('bi-eye');
  }
});

// ✅ Login Handler
loginForm.addEventListener('submit', e => {
  e.preventDefault();

  if (captchaInput.value.trim().toUpperCase() !== captchaCode) {
    alert("Captcha incorrect!");
    captchaCode = newCaptcha();
    captchaInput.value = '';
    return;
  }

  const storedUser = JSON.parse(localStorage.getItem('user') || 'null');
  if (!storedUser) {
    alert("No user found. Please sign up first.");
    return;
  }

  const enteredUser = document.getElementById('loginUser').value.trim();
  const enteredPass = passwordField.value;

  if ((enteredUser === storedUser.email || enteredUser === storedUser.mobile) &&
      enteredPass === storedUser.password) {
    alert("✅ Login successful!");
    window.location.href = "index.html";
  } else {
    alert("❌ Invalid credentials!");
  }
});
</script>
</body>
</html>
